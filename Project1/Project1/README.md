Υλοποίηση Συστημάτων Βάσεων Δεδομένων - Εργασία Χειμερινού Εξαμήνου 2021-2022
Εργασία 1

Παραδοχές:
Θεωρούμε ότι: 
1. 1 bucket=1 block
2. Το ευρετήριο αποθηκεύετε στο block 1 του αρχείου
3. Στο μπλοκ 0 έχουμε αποθηκεύσει το global_depth
4. Στα μπλοκ όπου αποθηκεύονται τα δεδομένα έχουμε αποθηκευμένο το local_depth και μία θέση πιο κάτω το αριθμό των εγγραφών που περιέχει ο κάδος.
5. Αφού ένα block έχει μέγεθος 512 ξέρουμε ότι ο μέγιστος αριθμός εγγραφών που χωράει είναι 8. (αφού sizeof(record)=8)

Υλοποίηση:

Η υλοποίηση του συγκεκριμένου προγράμματος αναπτύχθηκε ως εξής. Δημιουργούμε έναν global πίνακα ο οποίος κρατάει τα ανοιχτά αρχεία στην μορφή structs όπου διατηρούν το όνομα και τον αναγνωριστικό αριθμό του αρχείου. Αυτός ο πίνακας αρχικοποιείται σε -1 προκειμένου να είναι πιο εύκολο να αναγνωρίσουμε τις κενές θέσεις και να τοποθετήσουμε εκεί ένα νέο αρχείο που ανοίγει.

Η συνάρτηση CreateIndex λειτουργεί βάση την περιγραφή που μας δόθηκε αρχικοποιεί το index και αποθηκεύει τις κατάλληλες πληροφορίες στα 2 πρώτα block. Η OpenIndex ανοίγει ένα νέο αρχείο και το αποθηκεύει στην κατάλληλη θέση του global πίνακα αν υπάρχει χώρος. Αντίστοιχα η CloseFile κλείνει ένα ανοιχτό αρχείο και αποδεσμεύει ότι χρειάζεται. Αντίστοιχα η συνάρτηση PrintAllEntries διασχίζει το αρχείο επεκτατού κατακερματισμού και βρίσκει τις εγγραφές που έχουν record id ίσο με το δοθέντο ή αν το id που μας έχει δοθεί ισούται με NULL τότε επιστρέφει και τυπώνει όλες τις εγγραφές.

H συνάρτηση Insert τοποθετεί μια εγγραφή στο αρχείο και λειτουργεί ως εξής:
Περνάει ως όρισμα στη hashFunction το id της εγγραφής και η hashFunction του επιστρέφει την τιμή hashValue. Στη συνέχεια πάει στη θέση hashValue του ευρετηρίου και πάει να βάλει την εγγραφή στο κάδο που δείχνει η συγκεκριμένη θέση. Ελέγχουμε τον αριθμό των εγγραφών που περιέχονται στο κάδο και αν είναι μικρότερος του 8 βάζουμε την εγγραφή. Αν όμως ο κάδος είναι γεμάτος (δλδ περιέχει ήδη 8 εγγραφές) η εγγραφή δε μπορεί να τοποθετηθεί και υπάρχουν δύο εκδοχες. 1)Αν το local_depth=global_depth τότε μεγαλώνουμε το ευρετήριο στο διπλάσιο,κάνουμε κάθε δύο διαδοχικές θέσεις του ευρετηρίου να δείχνουν στον ίδιο κάδο. Στη συνέχεια δημιουργούμε ένα νέο μπλοκ στο οποίο θα δείχνει η θέση hashValue του πίνακα του ευρετηρίου και ξαναπερνάμε στο αρχείο όλες τις εγγραφές που περιέχονται στο  κάδο στον οποίο προσπαθήσαμε εξαρχής να βάλουμε την εγγραφή και μετα παιρνάμε και την εγγραφή που ζητήθηκε. 2)Αν το local_depth<global_depth τότε δημιουργούμε ένα νέο κάδο στον οποίο δείχνει η θέση hashValue του ευρετηρίου και ξαναπερνάμε στο αρχείο όλες τις εγγραφές του κάδου που προσπαθήσαμε εξαρχής να βάλουμε την εγγραφή και μετα παιρνάμε και την εγγραφή που ζητήθηκε στην αρχή.

Τελός η HashStatistics λειτουργεί σύμφωνα με την περιγραφή που μας δόθηκε, ανοίγει το αρχείο και επιστρέφει τις κατάλληλες πληροφορίες.
